(function(t){"use strict";var e={};if(localStorage.notebook){e=JSON.parse(localStorage.notebook)}else{var o=(new Date).toISOString();e={created:o,updated:o,sheets:[]}}e.load=function(o,a){var n=[];e.sheets.slice(o||0,a).forEach(function(t,o){n.push(e.parse(t,o+1))});t("#math-notebook").html(n.join("")).scrollTop(t("#math-notebook").height());if(window.MathJax){MathJax.Hub.Queue(["Typeset",MathJax.Hub,"math-notebook"])}};e.parse=function(t,e){var o={id:e,expr:t.expr,tex:String(t.tex).replace(/^[\$]{2}(.*)[\$]{2}$/,"\\(\\displaystyle $1\\)")};if(t.result){o.state="success";o.report=JSON.stringify(t.result,null,1)}else if(t.error){o.state="danger";o.report=t.error}return schema.format('<li id="sheet-${id}"><div><code>(i${id})</code> ${expr}</div><div><p class="ui-offset-small ui-text-indent">${tex}</p><code>(o${id})</code> <span class="ui-color-${state}">${report}</span></div></li>',o)};e.save=function(t){this.updated=(new Date).toISOString();this.sheets.push(t);localStorage.notebook=JSON.stringify(this)};e.export=function(){var t=JSON.stringify(this,null,2);window.open("data:application/json;charset=utf-8,"+encodeURIComponent(t))};e.display=function(o){var a=t("#math-notebook > li").size()+1;t("#math-notebook").append(e.parse(o,a)).scrollTop(t("#math-notebook").height());if(window.MathJax){MathJax.Hub.Queue(["Typeset",MathJax.Hub,"sheet-"+a])}};e.init=function(){e.load();t("#parser-form").on("submit",function(){var o=t(this);var a=o.find("textarea");var n=a.val().trim();if(n!==""){t.post(o.attr("action"),o.serialize(),function(t){e.display(t);e.save(t)});a.val("")}return false})};t(document).ready(function(){e.init();t("#notebook-view").on("click",function(){e.load()});t("#notebook-clear").on("click",function(){t("#math-notebook").empty()});t("#notebook-export").on("click",function(){e.export()});t("#notebook-delete").on("click",function(){localStorage.clear("notebook");t("#math-notebook").empty()})})})(jQuery);