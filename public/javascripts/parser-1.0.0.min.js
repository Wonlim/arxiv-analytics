(function(o){"use strict";var t={};if(localStorage.notebook){t=JSON.parse(localStorage.notebook)}else{var e=(new Date).toISOString();t={created:e,updated:e,sheets:[]}}t.load=function(e,a){var n=[];t.sheets.slice(e||0,a).forEach(function(o,e){n.push(t.parse(o,e+1))});o("#math-notebook").html(n.join("")).scrollTop(o("#math-notebook").height());if(window.MathJax){MathJax.Hub.Queue(["Typeset",MathJax.Hub,"math-notebook"])}};t.parse=function(o,t){var e="sheet-"+t;var a="<code>(i"+t+")</code> ";var n="<code>(o"+t+")</code> ";var i="<div>"+a+o.expr+"</div>";if(o.tex){i+="<div>"+o.tex+"</div>"}if(o.result){var r=JSON.stringify(o.result,null,1);i+="<div>"+n+'<span class="ui-color-success">'+r+"</span></div>"}else if(o.error){i+="<div>"+n+'<span class="ui-color-danger">'+o.error+"</span></div>"}return'<li id="'+e+'">'+i+"</li>"};t.save=function(o){this.updated=(new Date).toISOString();this.sheets.push(o);localStorage.notebook=JSON.stringify(this)};t.export=function(){var o=JSON.stringify(this,null,2);window.open("data:application/json;charset=utf-8,"+encodeURIComponent(o))};t.display=function(e){var a=o("#math-notebook > li").size()+1;o("#math-notebook").append(t.parse(e,a)).scrollTop(o("#math-notebook").height());if(window.MathJax){MathJax.Hub.Queue(["Typeset",MathJax.Hub,"sheet-"+a])}};t.init=function(){t.load();o("#parser-form").on("submit",function(){var e=o(this);var a=e.find("textarea");var n=a.val().trim();if(n!==""){o.post(e.attr("action"),e.serialize(),function(o){t.display(o);t.save(o)});a.val("")}return false})};o(document).ready(function(){t.init();o("#notebook-view").on("click",function(){t.load()});o("#notebook-clear").on("click",function(){o("#math-notebook").empty()});o("#notebook-export").on("click",function(){t.export()});o("#notebook-delete").on("click",function(){localStorage.clear("notebook");o("#math-notebook").empty()})})})(jQuery);